/// <reference path="../typings/index.d.ts" />
"use strict";
/**
 * Should probably be a class
 */
exports.convertDomains = (moduleName, domains) => {
    const emit = (str) => {
        emitStr += str;
    };
    const emitIndent = () => {
        for (let i = 0; i < numIndents; ++i) {
            emitStr += "    "; // 4 spaced indents
        }
    };
    const emitLine = (str = "") => {
        if (str) {
            emitIndent();
            emit(`${str}\n`);
        }
        else {
            emit("\n");
        }
    };
    const emitOpenBlock = (str, openChar = ' {') => {
        emitLine(`${str}${openChar}`);
        numIndents++;
    };
    const emitCloseBlock = (closeChar = '}') => {
        numIndents--;
        emitLine(closeChar);
    };
    const emitHeaderComments = () => {
        emitLine("/***********************************************************");
        emitLine(" * Auto-generated by protocolToCrdp. Do not edit manually.");
        emitLine(" ***********************************************************/");
        emitLine();
    };
    const emitModule = (moduleName, domains) => {
        moduleName = toTitleCase(moduleName);
        emitHeaderComments();
        emitOpenBlock(`export namespace ${moduleName}`);
        emitGlobalTypeDefs();
        emitInterface(`${moduleName}Client`, domains.map(d => getDomainDef(d.domain, 'Client')));
        emitInterface(`${moduleName}Server`, domains.map(d => getDomainDef(d.domain, 'Server')));
        domains.forEach(emitDomain);
        emitCloseBlock();
        emitLine();
        emitLine(`export default ${moduleName};`);
    };
    const emitGlobalTypeDefs = () => {
        emitLine();
        emitLine(`export type integer = number`);
    };
    const emitDomain = (domain) => {
        const domainName = toTitleCase(domain.domain);
        emitLine();
        emitDescription(domain.description);
        emitOpenBlock(`export module ${domainName}`);
        domain.types ? domain.types.forEach(emitType) : null;
        const commandDefs = domain.commands ? domain.commands.map(c => emitCommand(c, domainName)) : [];
        const eventDefs = domain.events ? domain.events.map(e => emitEvent(e, domainName)) : [];
        const functionDefs = commandDefs.concat(eventDefs);
        emitCloseBlock();
        emitInterface(`${domainName}Commands`, commandDefs.map(d => d.client));
        emitInterface(`${domainName}Client extends ${domainName}Commands`, eventDefs.map(d => d.client));
        emitInterface(`${domainName}Server`, eventDefs.concat(commandDefs[0]).map(d => d.server));
    };
    const getDomainDef = (domainName, $ref) => {
        return { name: domainName, $ref: `${domainName}${$ref}` };
    };
    const formatDescription = (description) => `/** ${description.replace(/<code>(.*)<\/code>/g, "'$1'")} */`;
    const emitDescription = (description) => {
        description ? emitLine(formatDescription(description)) : null;
    };
    const getPropertyDef = (prop) => {
        if (prop.type == "function") {
            return `${prop.name}${getPropertyType(prop)}`;
        }
        else {
            return `${prop.name}${prop.optional ? '?' : ''}: ${getPropertyType(prop)}`;
        }
    };
    const getPropertyType = (prop) => {
        if (prop.$ref)
            return prop.$ref;
        else if (prop.type == 'array')
            return `${getPropertyType(prop.items)}[]`;
        else if (prop.type == 'object')
            return `any`;
        else if (prop.type == 'function')
            return `(${prop.accepts.map(getPropertyDef).join(', ')}): ${prop.returns || 'void'}`;
        else if (prop.type == 'lambda')
            return `(${prop.accepts.map(getPropertyDef).join(', ')}) => ${prop.returns || 'void'}`;
        else if (prop.type == 'string' && prop.enum)
            return '(' + prop.enum.map((v) => `'${v}'`).join(' | ') + ')';
        return prop.type;
    };
    const emitProperty = (prop) => {
        emitDescription(prop.description);
        emitLine(`${getPropertyDef(prop)};`);
        emitLine();
    };
    const emitInterface = (interfaceName, props, emitNewLine = true) => {
        emitNewLine ? emitLine() : null;
        emitOpenBlock(`export interface ${interfaceName}`);
        props ? props.forEach(emitProperty) : emitLine('[key: string]: string;');
        emitCloseBlock();
        return interfaceName;
    };
    const emitType = (type) => {
        emitLine();
        emitDescription(type.description);
        if (type.type === "object") {
            emitInterface(type.id, type.properties, false);
        }
        else {
            emitLine(`export type ${type.id} = ${getPropertyType(type)};`);
        }
    };
    const toTitleCase = (str) => str[0].toUpperCase() + str.substr(1);
    const emitCommand = (command, domain) => {
        const titleCase = toTitleCase(command.name);
        const requestType = command.parameters ? `${domain}.${emitInterface(`${titleCase}Request`, command.parameters)}` : null;
        const responseType = command.returns ? `${domain}.${emitInterface(`${titleCase}Response`, command.returns)}` : null;
        const paramsDef = requestType ? [{ name: 'params', $ref: requestType }] : [];
        const methodDef = [{ name: 'method', $ref: `'${domain}.${command.name}'` }];
        const clientDef = {
            type: 'lambda',
            description: command.description,
            name: command.name,
            optional: true,
            accepts: paramsDef,
            returns: `Promise<${responseType || 'void'}>`
        };
        const serverDef = {
            type: "function",
            name: "expose",
            accepts: [
                { name: "domain", $ref: `${domain}Commands` }
            ],
        };
        const commandDef = {
            name: command.name,
            client: clientDef,
            server: serverDef
        };
        return commandDef;
    };
    const emitEvent = (event, domain) => {
        const titleCase = toTitleCase(event.name);
        const eventType = event.parameters ? `${domain}.${emitInterface(`${titleCase}Event`, event.parameters)}` : '';
        const paramsDef = eventType ? [{ name: 'params', $ref: eventType }] : [];
        const clientDef = {
            type: 'function',
            description: event.description,
            name: `on${titleCase}`,
            accepts: [
                {
                    name: "handler",
                    type: "lambda",
                    accepts: paramsDef
                }
            ],
        };
        const eventDef = {
            name: event.name,
            client: clientDef,
            server: Object.assign({}, clientDef, {
                name: `emit${titleCase}`,
                accepts: paramsDef
            })
        };
        return eventDef;
    };
    const emitNames = (names, arrayName) => {
        emitLine();
        emitOpenBlock(`export const ${arrayName}: string[] = `, '[');
        names.forEach(s => emitLine(`'${s.name}',`));
        emitCloseBlock(']');
    };
    let numIndents = 0;
    let emitStr = "";
    emitModule(moduleName, domains);
    return emitStr;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvdG9jb2xUb0NyZHAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvcHJvdG9jb2xUb0NyZHAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOENBQThDOztBQWU5Qzs7R0FFRztBQUNVLHNCQUFjLEdBQUcsQ0FBQyxVQUFpQixFQUFFLE9BQW1CO0lBQ2pFLE1BQU0sSUFBSSxHQUFHLENBQUMsR0FBVztRQUNyQixPQUFPLElBQUksR0FBRyxDQUFBO0lBQ2xCLENBQUMsQ0FBQTtJQUVELE1BQU0sVUFBVSxHQUFHO1FBQ2YsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNsQyxPQUFPLElBQUksTUFBTSxDQUFBLENBQUMsbUJBQW1CO1FBQ3pDLENBQUM7SUFDTCxDQUFDLENBQUE7SUFFRCxNQUFNLFFBQVEsR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFO1FBQ3RCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDTixVQUFVLEVBQUUsQ0FBQTtZQUNaLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDcEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ0osSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQ2QsQ0FBQztJQUNMLENBQUMsQ0FBQTtJQUVELE1BQU0sYUFBYSxHQUFHLENBQUMsR0FBVyxFQUFFLFFBQVEsR0FBRyxJQUFJO1FBQy9DLFFBQVEsQ0FBQyxHQUFHLEdBQUcsR0FBRyxRQUFRLEVBQUUsQ0FBQyxDQUFBO1FBQzdCLFVBQVUsRUFBRSxDQUFBO0lBQ2hCLENBQUMsQ0FBQTtJQUVELE1BQU0sY0FBYyxHQUFHLENBQUMsU0FBUyxHQUFHLEdBQUc7UUFDbkMsVUFBVSxFQUFFLENBQUE7UUFDWixRQUFRLENBQUMsU0FBUyxDQUFDLENBQUE7SUFDdkIsQ0FBQyxDQUFBO0lBRUQs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